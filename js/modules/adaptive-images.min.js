export function initAdaptiveImages(){const connection=navigator.connection||navigator.mozConnection||navigator.webkitConnection;const saveData=connection?.saveData||false;const networkStrategy=getNetworkStrategy(connection,saveData);(`ğŸŒ Network Strategy:${networkStrategy.type}`);(pozwala przeglÄ…darce samej wybraÄ‡)applyImageStrategy(networkStrategy);(np. przejÅ›cie z WiFi na 3G)let debounceTimer=null;if(connection){connection.addEventListener("change",()=>{clearTimeout(debounceTimer);debounceTimer=setTimeout(()=>{const newStrategy=getNetworkStrategy(connection,connection?.saveData);(`ğŸ”„ Network changed:${newStrategy.type}`);applyImageStrategy(newStrategy);},300);});}}function getNetworkStrategy(connection,saveData){if(saveData){return{type:"save-data",quality:"low",maxWidth:800,format:"webp",lazy:true,description:"Data Saver Mode-uÅ¼ytkownik oszczÄ™dza transfer",};}const effectiveType=connection?.effectiveType;switch(effectiveType){case "slow-2g":case "2g":return{type:"2g",quality:"low",maxWidth:400,format:"webp",lazy:true,description:"2G-bardzo wolne poÅ‚Ä…czenie",};case "3g":return{type:"3g",quality:"medium",maxWidth:800,format:"webp",lazy:true,description:"3G-Å›rednie poÅ‚Ä…czenie",};case "4g":return{type:"4g",quality:"high",maxWidth:1600,format:"avif",lazy:false,description:"4G-szybkie poÅ‚Ä…czenie",};default:return{type:"wifi",quality:"high",maxWidth:1600,format:"avif",lazy:false,description:"WiFi/Unknown-zakÅ‚adamy szybkie poÅ‚Ä…czenie",};}}function applyImageStrategy(strategy){(4G,WiFi)NIE MODYFIKUJ srcset const shouldOptimize=strategy.type!=="4g"&&strategy.type!=="wifi";if(!shouldOptimize){return;}const pictures=document.querySelectorAll("picture");pictures.forEach((picture)=>{const sources=picture.querySelectorAll("source");const img=picture.querySelector("img");sources.forEach((source)=>{const originalSrcset=source.dataset.originalSrcset||source.getAttribute("srcset");(jeÅ›li jeszcze nie)if(!source.dataset.originalSrcset){source.dataset.originalSrcset=originalSrcset;}const filteredSrcset=filterSrcsetByWidth(originalSrcset,strategy.maxWidth);source.setAttribute("srcset",filteredSrcset);if(strategy.format==="webp"&&source.getAttribute("type")==="image/avif"){source.setAttribute("media","(max-width:0px)");}else if(source.getAttribute("type")==="image/avif"){source.removeAttribute("media");}});if(strategy.lazy&&img){img.setAttribute("loading","lazy");}});(opcjonalnie)showNetworkIndicator(strategy);}function filterSrcsetByWidth(srcset,maxWidth){if(!srcset)return "";const entries=srcset.split(",").map((entry)=>entry.trim());return entries .filter((entry)=>{const match=entry.match(/(\d+)w$/);if(!match)return true;const width=parseInt(match[1]);return width<=maxWidth;}).join(",");}function showNetworkIndicator(strategy){const oldIndicator=document.getElementById("network-indicator");if(oldIndicator)oldIndicator.remove();if(strategy.type==="4g"||strategy.type==="wifi")return;const indicator=document.createElement("div");indicator.id="network-indicator";indicator.style.cssText=` position:fixed;bottom:60px;right:20px;background:rgba(204,0,0,0.9);color:white;padding:10px 15px;border-radius:5px;font-size:12px;z-index:9999;animation:slideIn 0.3s ease-out;`;indicator.innerHTML=`<strong>ğŸŒ ${strategy.type.toUpperCase()}</strong><br>Obrazy w trybie oszczÄ™dnym `;document.body.appendChild(indicator);setTimeout(()=>{indicator.style.animation="slideOut 0.3s ease-out";setTimeout(()=>indicator.remove(),300);},5000);}const style=document.createElement("style");style.textContent=` @keyframes slideIn{from{transform:translateX(120%);opacity:0;}to{transform:translateX(0);opacity:1;}}@keyframes slideOut{from{transform:translateX(0);opacity:1;}to{transform:translateX(120%);opacity:0;}}`;document.head.appendChild(style);