import{CONFIG}from './config.js';import{initMatrix}from './core/matrix.js';import{initUI,initCursor}from './core/ui.js';import{initPortfolio}from './modules/portfolio.js';import{initContact}from './modules/contact.js';import{initHud}from './modules/hud.js';import{initMaintenance}from './modules/maintenance.js';import{initAdaptiveImages}from './modules/adaptive-images.js';import{initPrivacyPolicy}from './modules/privacy-policy.js';let preloaderAnimId=null;let preloaderResizeCleanup=null;(CPU OPTIMIZED)===function initPreloaderMatrix(){const canvas=document.getElementById("preloader-matrix");if(!canvas)return;const ctx=canvas.getContext("2d");let width=(canvas.width=window.innerWidth);let height=(canvas.height=window.innerHeight);const cols=Math.floor(width/20);const ypos=Array(cols).fill(0);let lastTime=0;const fps=15;let interval=1000/fps;(only on capable devices)let frameCount=0;const fastLoadFrames=120;const isSlowConnection=navigator.connection?.effectiveType==='2g'||navigator.connection?.saveData;const isLowEnd=navigator.hardwareConcurrency&&navigator.hardwareConcurrency<4;const fastFPS=(isSlowConnection||isLowEnd)?15:30;const resizeHandler=()=>{width=canvas.width=window.innerWidth;height=canvas.height=window.innerHeight;};window.addEventListener("resize",resizeHandler,{passive:true});preloaderResizeCleanup=()=>{window.removeEventListener("resize",resizeHandler);};function matrixLoop(currentTime){preloaderAnimId=requestAnimationFrame(matrixLoop);if(!currentTime)currentTime=0;if(frameCount<fastLoadFrames){interval=1000/fastFPS;frameCount++;}else{interval=1000/fps;}const delta=currentTime-lastTime;if(delta<interval)return;lastTime=currentTime-(delta%interval);ctx.fillStyle="rgba(5,5,5,0.08)";ctx.fillRect(0,0,width,height);ctx.font="15pt monospace";ypos.forEach((y,ind)=>{const chars="01アイウエオカキクケコサシスセソタチツテトナニヌネノハヒフヘホマミムメモヤユヨラリルレロワヲン";const text=chars[Math.floor(Math.random()*chars.length)];const x=ind*20;ctx.fillStyle=Math.random()>0.98?"#fff":"#ff1f1f";ctx.fillText(text,x,y);if(y>100+Math.random()*10000){ypos[ind]=0;}else{ypos[ind]=y+20;}});}requestAnimationFrame(matrixLoop);}document.addEventListener("DOMContentLoaded",()=>{initCursor();(A11Y-No Hash Change)===const skipLinkBtn=document.getElementById('skip-link-btn');if(skipLinkBtn){skipLinkBtn.addEventListener('click',(e)=>{e.preventDefault();const target=document.getElementById('hero');if(target){if(!target.hasAttribute('tabindex')){target.setAttribute('tabindex','-1');}target.scrollIntoView({behavior:'smooth'});target.focus({preventScroll:true});}});}(only if no hash)if(!window.location.hash){window.scrollTo(0,0);}if(CONFIG.enablePreloader){initPreloaderMatrix();}const urlParams=new URLSearchParams(window.location.search);const isAdmin=urlParams.get('admin')==='true';if(CONFIG.maintenanceMode&&!isAdmin){const siteContent=document.getElementById("site-content");if(siteContent){siteContent.style.display="none";}const preloader=document.getElementById("preloader");if(preloader)preloader.style.display="none";if(preloaderAnimId){cancelAnimationFrame(preloaderAnimId);preloaderAnimId=null;}if(preloaderResizeCleanup){preloaderResizeCleanup();preloaderResizeCleanup=null;}initMaintenance();return;}(Lightweight)===initPortfolio();initContact();initPrivacyPolicy();(Network-Aware Loading)===initAdaptiveImages();(Optimized)===const preloader=document.getElementById("preloader");const killPreloader=()=>{if(!preloader)return;if(preloader.classList.contains("hiding"))return;preloader.classList.add("hiding");preloader.classList.add("loaded");setTimeout(()=>{preloader.style.display="none";document.body.style.overflow='';document.body.style.height='';if(preloaderAnimId){cancelAnimationFrame(preloaderAnimId);preloaderAnimId=null;}if(preloaderResizeCleanup){preloaderResizeCleanup();preloaderResizeCleanup=null;}(Matrix+UI)initMatrix();initUI();if(window.location.hash){const targetId=window.location.hash.substring(1);const target=document.getElementById(targetId);if(target){const allReveals=document.querySelectorAll('.reveal:not(.active)');allReveals.forEach(el=>el.classList.add('active'));document.body.offsetHeight;setTimeout(()=>{const rect=target.getBoundingClientRect();const offset=window.pageYOffset+rect.top-80;window.scrollTo({top:offset,behavior:'smooth'});},100);}}setTimeout(initHud,200);},550);};if(CONFIG.enablePreloader&&preloader){if(document.readyState==='complete'){(cached)setTimeout(killPreloader,300);}else{setTimeout(killPreloader,700);}}else{if(preloader)preloader.style.display="none";document.body.style.overflow='';document.body.style.height='';initMatrix();initUI();initHud();}(Load on Demand Only)===const chatTrigger=document.getElementById("chatbot-trigger");if(chatTrigger){let chatbotLoaded=false;let pendingOpen=false;const loadChatbot=async()=>{if(chatbotLoaded)return;chatbotLoaded=true;try{const{initChat}=await import('./modules/chatbot.js');const chatAPI=initChat();if(pendingOpen){pendingOpen=false;if(chatAPI&&typeof chatAPI.open==='function'){chatAPI.open();}}}catch(error){console.error("❌ Failed to load chatbot:",error);chatbotLoaded=false;if(chatTrigger){chatTrigger.style.opacity="0.5";chatTrigger.title="Chatbot temporarily unavailable";chatTrigger.style.cursor="not-allowed";}}};let touchFired=false;const handleInteraction=async(e)=>{if(e.type==='touchend'){touchFired=true;setTimeout(()=>{touchFired=false;},400);}else if(e.type==='click'&&touchFired){return;}if(!chatbotLoaded){e.preventDefault();pendingOpen=true;await loadChatbot();}};(desktop only)chatTrigger.addEventListener("mouseenter",loadChatbot,{once:true});chatTrigger.addEventListener("touchend",handleInteraction,{passive:false});chatTrigger.addEventListener("click",handleInteraction);}});